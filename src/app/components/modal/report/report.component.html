<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="cancel()">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Nouveau Signalement</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="form-container">
    <div class="input-group">
      <div class="custom-item">
        <ion-icon name="location-outline" color="primary"></ion-icon>
        <div class="input-wrapper">
          <label class="custom-label">Coordonnées</label>
          <div class="readonly-box">
            {{ lat.toFixed(6) }}, {{ lng.toFixed(6) }}
          </div>
        </div>
      </div>

      <div class="custom-item">
        <ion-icon name="resize-outline" color="primary"></ion-icon>
        <div class="input-wrapper">
          <label class="custom-label">Surface estimée (m²)</label>
          <input type="number" [(ngModel)]="surface" placeholder="Ex: 15" class="native-input">
        </div>
      </div>

      <div class="custom-item textarea-item">
        <ion-icon name="document-text-outline" color="primary"></ion-icon>
        <div class="input-wrapper">
          <label class="custom-label">Description</label>
          <textarea
            [(ngModel)]="description"
            placeholder="Précisez la nature du problème..."
            rows="4"
            class="native-textarea">
          </textarea>
        </div>
      </div>
    </div>

    <div class="photo-section">
      <div class="section-title">
        <span>Photos du problème</span>
        <ion-badge color="primary">{{ photos.length }}</ion-badge>
      </div>

      <div class="image-grid">
        <div class="image-item" *ngFor="let p of photos; let i = index">
          <img [src]="p" (click)="previewImage(p)" />
          <button class="btn-remove" (click)="removePhoto(i, $event)">
            <ion-icon name="close-circle" color="danger"></ion-icon>
          </button>
        </div>

        <div class="add-image-btn" (click)="presentImageSourceHelper()">
          <ion-icon name="camera-outline"></ion-icon>
          <span>Ajouter</span>
        </div>
      </div>
    </div>
  </div>

  <div class="full-preview" *ngIf="selectedPreview" (click)="selectedPreview = null">
    <div class="preview-content" (click)="$event.stopPropagation()">
      <img [src]="selectedPreview" />
      <ion-button fill="clear" color="light" class="close-preview" (click)="selectedPreview = null">
        <ion-icon name="close-circle" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  <div class="footer-inner">
    <ion-button expand="block" shape="round" (click)="confirm()" [disabled]="!surface || photos.length === 0">
      <ion-icon name="checkmark-outline" slot="start"></ion-icon>
      Confirmer le signalement
    </ion-button>
  </div>
</ion-footer>
